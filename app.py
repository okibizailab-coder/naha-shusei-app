import streamlit as st
import pandas as pd
from datetime import datetime, timedelta

# --- è¨­å®šã¨ãƒ‡ã‚¶ã‚¤ãƒ³ ---
st.set_page_config(page_title="å®ˆæˆã‚¯ãƒ©ãƒ–é‚£è¦‡ é‹å–¶ã‚¢ã‚·ã‚¹ãƒˆ", layout="wide")

# --- ãƒ€ãƒŸãƒ¼åç°¿ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãªã„å ´åˆã®åˆæœŸå€¤ï¼‰ ---
default_members = [
    {"æ°å": "ä¼Šé›† æ¯”ä½ä¹ƒ", "èª­ã¿": "ã„ã˜ã‚…ã† ã²ã•ã®", "ä¼šç¤¾å": "æ ªå¼ä¼šç¤¾Office IJU", "å½¹è·": "ä»£è¡¨ä¸–è©±äºº"},
    {"æ°å": "æ¡œäº• æœ‰é‡Œ", "èª­ã¿": "ã•ãã‚‰ã„ ã‚†ã‚Š", "ä¼šç¤¾å": "MKCAFE/ãƒ”ã‚«ãƒ”ã‚«æ²–ç¸„", "å½¹è·": "å¸ä¼š"},
    {"æ°å": "ç¥ç”°æ©‹ ã‚ãšã•", "èª­ã¿": "ã‹ã‚“ã ã°ã— ã‚ãšã•", "ä¼šç¤¾å": "åˆåŒä¼šç¤¾Welina", "å½¹è·": "å¸ä¼š"},
    {"æ°å": "å®‰é‡Œ æ­£ç›´", "èª­ã¿": "ã‚ã•ã¨ ã¾ã•ãªãŠ", "ä¼šç¤¾å": "G-Buster BARã‹ã‚Šã€œ", "å½¹è·": "æ——æ‰‹"},
    {"æ°å": "ä»²æ‘ åº·æˆ", "èª­ã¿": "ãªã‹ã‚€ã‚‰ ã‚„ã™ãªã‚Š", "ä¼šç¤¾å": "ä»²æ‘å•†äº‹", "å½¹è·": "TM"},
    {"æ°å": "èµ¤å¶º å‰›", "èª­ã¿": "ã‚ã‹ã¿ã­ ã¤ã‚ˆã—", "ä¼šç¤¾å": "èµ¤å¶ºè¨­å‚™", "å½¹è·": "TM"},
]

# --- 1. ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼šåç°¿ç®¡ç†ã¨è¨­å®š ---
st.sidebar.header("ğŸ“ äº‹å‹™å±€è¨­å®š")
uploaded_file = st.sidebar.file_uploader("åç°¿Excel/CSVã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰", type=['csv', 'xlsx'])

if uploaded_file:
    # å®Ÿéš›ã¯ã“ã“ã§èª­ã¿è¾¼ã¿å‡¦ç†
    member_df = pd.DataFrame(default_members) 
    st.sidebar.success("åç°¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ")
else:
    member_df = pd.DataFrame(default_members)

# --- 2. ãƒ¡ã‚¤ãƒ³ç”»é¢ï¼šã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ---
tab1, tab2, tab3 = st.tabs(["ğŸ§© æº–å‚™ï¼šå½¹å‰²é…ç½®", "ğŸ“‹ æœ¬ç•ªï¼šãƒ©ã‚¤ãƒ–å°æœ¬", "ğŸ“Š è¨˜éŒ²ï¼šã‚¢ãƒ¼ã‚«ã‚¤ãƒ–"])

# --- Tab 1: å½¹å‰²é…ç½® ---
with tab1:
    st.header("ãƒ†ãƒ¼ãƒ–ãƒ«ãƒã‚¹ã‚¿ãƒ¼(TM)é…ç½®")
    tm_list = member_df["æ°å"].tolist()
    
    col_a, col_b = st.columns(2)
    tm_assignments = {}
    for i in range(1, 13):
        target_col = col_a if i <= 6 else col_b
        tm_assignments[i] = target_col.selectbox(f"ç¬¬ {i} å“ TM", ["æœªé¸æŠ"] + tm_list, key=f"tm_{i}")

    st.header("ã‚²ã‚¹ãƒˆç´¹ä»‹ãƒ»å…¥ä¼šè€…")
    guest_count = st.number_input("æœ¬æ—¥ã®ã‚²ã‚¹ãƒˆäººæ•°", value=12)
    st.info(f"ã‚²ã‚¹ãƒˆç´¹ä»‹ã®æƒ³å®šæ™‚é–“: {guest_count * 10}ç§’ (1äºº10ç§’è¨ˆç®—)")

# --- Tab 2: ãƒ©ã‚¤ãƒ–å°æœ¬ï¼ˆé‚£è¦‡ä¼šå ´ä»•æ§˜ï¼‰ ---
with tab2:
    st.header("ç¬¬56å› å®ˆæˆã‚¯ãƒ©ãƒ–é‚£è¦‡ä¼šå ´ ãƒ©ã‚¤ãƒ–é€²è¡Œ")
    
    # æ™‚é–“è¨ˆç®—
    start_time = datetime.strptime("14:00", "%H:%M")
    
    # é€²è¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³
    st.markdown("### ã€ç¬¬1éƒ¨ã€‘ 14:00 ã‚¹ã‚¿ãƒ¼ãƒˆ")
    
    # é€²è¡Œã®è¡Œ
    c1, c2, c3 = st.columns([1, 1, 3])
    c1.write("**14:00**")
    c2.write("å¸ä¼š")
    c3.error("ğŸ’¡ ç…§æ˜æŒ‡ç¤ºï¼šå£‡ä¸Šç…§æ˜OFF / ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°å‹•ç”»å†ç”Ÿ") # [cite: 18]
    
    st.markdown("---")
    
    c1, c2, c3 = st.columns([1, 1, 3])
    c1.write("**14:03**")
    c2.write("å¸ä¼š")
    c3.success("ğŸ’¡ ç…§æ˜æŒ‡ç¤ºï¼šå£‡ä¸Šç…§æ˜ON") # [cite: 18]
    c3.write(f"ã€ŒãŸã ã„ã¾ã‚ˆã‚Šã€ä»•äº‹ãƒãƒ³ãƒãƒ³ãƒ—ãƒ©ã‚¶é‚£è¦‡ã‚’é–‹ä¼šã„ãŸã—ã¾ã™ã€‚æœ¬æ—¥ã®å¸ä¼šã¯ã€{member_df.iloc[1]['æ°å']}ã¨ã€{member_df.iloc[2]['æ°å']}ã§ã™ã€‚ã€") # [cite: 18]

    # ã‚ã‚“ããƒ¼ã‚Œãƒœã‚¿ãƒ³
    st.markdown("---")
    st.subheader("å…¥ä¼šäºˆå®šè€…ç´¹ä»‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³")
    if st.button("ğŸ”¥ ã‚ã‚“ãã€œã‚Œã€œï¼ ç™ºå£°"):
        st.balloons()
        st.markdown("<h1 style='text-align:center; color:red; font-size:100px;'>ã‚ã‚“ãã€œã‚Œã€œï¼</h1>", unsafe_allow_html=True) # [cite: 59]
        st.success("ï¼ˆä¼šå ´å…¨å“¡ã§æ‹æ‰‹ï¼ï¼‰")

# --- Tab 3: ã‚¢ãƒ¼ã‚«ã‚¤ãƒ– ---
with tab3:
    st.header("éå»ã®å±¥æ­´")
    st.write("å‰å›ã®ã‚²ã‚¹ãƒˆãŒä»Šå›å…¥ä¼šã—ãŸã‹ç­‰ã®å±¥æ­´ã‚’ç®¡ç†ã—ã¾ã™ã€‚")
    st.table(member_df)
